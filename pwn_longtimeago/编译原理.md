# 编译原理

## 第二章 语言及其文法

### 1.基础概念

字母表表示一个有穷符号集合

字母表上运算1.乘积2.n次幂（长度为n的符号串构成的集合3.正闭包4.克林闭包

串是字母表中符号的一个有穷序列，长度及个数记作|S|，空串长度为0

串上的运算-连接，幂，0次幂就是空串

### 2.文法的定义

文法的形式化定义

G=（终结符集合，非终结符集合，产生式集合，开始符号）

简化形式直接写产生式集合

符号约定：

终结符 a,b,c 非终结符 A,B,C 文法符号 X,Y,Z

终结符号串 u,v ... 文法符号串 γ,β...

### 3.语言的定义

推导和归纳的概念

由开始符推导出文法符号串，这个文法符号串称为句型，这个句型中不包括非终结符的话，称为句子

由文法G的开始符号S推导出的所有句子构成的集合称为文法G生成的语言，记为L(G)

语言上的运算包括：并，连接，幂，正闭包，克林闭包。

### 4.文法的分类

0型文法：

​	也称无限制文法/短语结构文法 

​	产生式左侧最少包含一个非终结符

1型文法：

​	上下文有关文法，产生式左侧符号数<=右侧符号数

2型文法：

​	上下文无关文法，产生式左侧是个符号且属于非终结符集合

3型文法：

​	**正则文法**：

​		右线性文法 A->wB A->w

​		左线性文法  A->Bw A->w

这四种文法逐级限制 0>1>2>3

### CFG(2型文法)的分析树

根结点的标号为文法开始符号。叶结点既可以是非终结符也可以是终结符。

从左到右排列叶节点得到的符号串称为是这棵树的产出或边缘。

分析树是推导的图形化表示

给定一个句型，其分析树中的每棵子树的边缘称为该句型的一个短语

​	如果子树只有父子两代结点，那么这棵子树的边缘称为该句型的一个直接短语

二义性文法：一个文法可以为某个句子产生多棵分析树，则称这个文法是二义性的

## 第三章 词法分析

### 正则表达式

正则表达式是一种用来描述正则语言的更紧凑的表示方法

每个正则表达式r定义一个语言，记为L(r)

正则表达式运算优先级 * 连接 |

|是可以交换，可以结合。连接可结合可分配

**正则文法与正则表达式等价**

### 正则定义

表达式左侧是一个新符号，右侧是一个正则表达式

### 有穷自动机

FA由转换图表示

包括：

​	结点：FA的状态

​	初始状态和终止状态

​	带标记的有向边

有穷自动机接收的语言记为 L(M)

### 有穷自动机的分类

1.确定的FA DFA

2.非确定的FA NFA

M=(有穷状态集，输入字母表，转换函数，开始状态，接收状态集合)

可以由转换表表示FA

DFA和NFA可以相互转换

### 从正则表达式到有穷自动机|从NFA到DFA

### 识别单词的DFA

词法分析阶段可检测错误类型

​	单词拼写错误

​	非法字符

词法错误检测

​	找已扫描字符串中最后一个对应于某终态的字符，找到了，将其识别为一个单词，继续识别，否则采用       	错误恢复策略（如“恐慌模式”）

## 第四章 语法分析

### 自顶向下分析概述

分为最左推导（最右归约）最右推导（最左归约）

最右推导和最左推导具有唯一性

自顶向下的语法分析采用最左推导

预测分析是递归下降分析技术的一个特例，通过在输入中向前看固定个数符号来选择正确的A-产生式

这类文法有时也被称为LL(k)文法类，预测分析不需要回溯，是一种确定的自顶向下分析方法

### 文法转换

问题1.同一非终结符的多个候选式存在共同前缀，将导致回溯现象

问题2.左递归文法会使递归向下分析器陷入无限循环

1.消除左直接递归2.消除左间接递归3.提取左公因子

### LL(1)文法

S_文法

每个产生式的右部都以终结符开始

同一非终结符的各个候选式的首终结符都不同，且不含空串表达式

非终结符的后继符号集

产生式的可选集

串首终结符集

文法G是LL(1)的，当且仅当任意两个具有相同左部的产生式，不存在终结符a使使其都能推导出以a开头的串

由select集可以制作预测分析表 编译原理4-4

### 递归的预测分析

通过写顺序程序完成（目测无法检测错误，直接崩）

### 非递归的预测分析法

根据预测分析表构造一个自动机，也叫表驱动的预测分析

用一种类似栈的方式

分为栈，剩余输入，输出。通过不断用第一个剩余输入与栈顶匹配完成处理

预测分析法实现步骤

1）构造文法

2）改造文法：消除二义性、消除左递归、消除回溯

3）求每个变量的FIRST集和FOLLOW集，从而求得每个候选式的SELECT集

4）检测是不是LL(1)文法。若是，构造文法分析表

5）对于递归的预测分析，根据预测分析表为每一个非终结符编写一个过程；

​	对于非递归的预测分析，实现表驱动的预测分析算法。

### 预测分析中的错误处理

检测错误：

栈顶的终结符和当前输入符号不匹配

栈顶非终结符与当前输入字符在预测分析表中对应项为空

预测分析中的错误恢复

​	恐慌模式：跳过输入符号直到匹配

​	如果终结符在栈顶不能匹配就弹出此终结符

分析表的使用方法：

​	如果M[A,a]为空，进入恐慌模式，忽略输入符号a

​	如果M[A,a]是synch，则弹出栈顶的非终结符A，试图继续分析后面的语法成分

​    如果栈顶的终结符和输入符号不匹配，则弹出栈顶的终结符

### 自底向上分析概述

### LR分析法

### SLR分析法

其与LR分析法差别在于，对于归约和移进操作，其会根据follow集和下一位待检测符号来采用不同方式(4-12）

### LR(1)

SLR加强版，增加了“展望符”，也就是规约后(左项)紧跟的终结符，也就是说，fllow集并不一定全是展望符（留空防止忽视错误）

### LALR分析法

在LR(1)上做空间优化，对归约项合并

合并同心项集可能导致错误被忽视，比如两个展望符是针对不同状态的，但是却一定会筛出错误。总结“归约可能会犯错，但移进不会”

### 二义性文法

LR分析法基础上，可以增加一些原则来避免二义性，如else与最近的if匹配

### 错误处理

如恐慌模式和短语层次错误处理

短语层次错误处理：根据程序员常出现的错误制定不用的错误项，触发后报错但继续处理。

## 第五章 语法制导翻译

语法制导翻译包括语义翻译和语法分析，语义翻译包括语义分析和中间代码生成

### 概述

语法制导定义(sdd)：将文法符号与语义属性集合相关联，将每个产生式与语义规则相关联

语法制导翻译方案(SDT)：在sdd基础上，在产生式右部嵌入语义动作{}，其的位置决定了这个动作的执行时间

### SDD

文法符号的属性包括综合属性和继承属性

终结符只有综合属性，其在词法分析时就确定

综合属性由其表达式右侧的符号或自己本身确定，继承属性由表达式中，自己左侧的符号表示，也就是说，其的左侧兄弟结点和父节点，不可以是右节点(lsdd的规定)。

### S-SDD与L-SDD

仅使用综合属性的sdd被称为sddd，其可以在自底向上的语法分析中实现

使用综合属性和继承属性的SDD都可被称为L-SDD。不过L-SDD对继承属性有限制，继承的父节点只能是继承属性(防止出现回路 )，继承兄弟结点只能继承左侧的。

### 语法制导翻译方案

可以根据其是综合属性还是继承属性来插入不同位置

S-SDD可以采用LR分析法，在栈中增加一个综合属性

如果一个L-SDD的基本文法符合LL分析技术，那么他的SDT也可以在LL或LR中实现

5.6 非递归预测分析中使用L-SDD

5.7 在递归分析中用L-SDD，通过设置参数和返回值与局部变量来完成

5.8 通过修改式子使其变成S-SDD再进行LR